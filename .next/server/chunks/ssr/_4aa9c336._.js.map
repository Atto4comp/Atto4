{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/lib/api/video-api.ts"],"sourcesContent":["// lib/api/video-api.ts\nimport axios from \"axios\";\n\nexport interface VideoSource {\n  url: string;\n  quality: string;\n  type: \"iframe\";\n  servers: string;\n  tmdbId: number;\n  mediaType: \"movie\" | \"tv\";\n  season?: number;\n  episode?: number;\n  title?: string;\n  episodeTitle?: string;\n}\n\n/** Parse season/episode from various URL formats */\nexport function parseSeasonEpisodeFromUrl(url: string): { season: number | null; episode: number | null } {\n  try {\n    const parsed = new URL(url);\n    const pathSegments = parsed.pathname.split('/').filter(Boolean);\n\n    // Try path-based: /tv/{id}/{season}/{episode}\n    if (pathSegments.length >= 4 && pathSegments[0] === 'tv') {\n      const season = parseInt(pathSegments[2], 10);\n      const episode = parseInt(pathSegments[3], 10);\n\n      if (!isNaN(season) && !isNaN(episode) && season > 0 && episode > 0) {\n        return { season, episode };\n      }\n    }\n\n    // Try query params: ?s=1&e=2 or ?season=1&episode=2\n    const seasonParam = parsed.searchParams.get('s') || parsed.searchParams.get('season');\n    const episodeParam = parsed.searchParams.get('e') || parsed.searchParams.get('episode');\n\n    if (seasonParam && episodeParam) {\n      const season = parseInt(seasonParam, 10);\n      const episode = parseInt(episodeParam, 10);\n\n      if (!isNaN(season) && !isNaN(episode) && season > 0 && episode > 0) {\n        return { season, episode };\n      }\n    }\n\n    return { season: null, episode: null };\n  } catch (error) {\n    console.warn('Failed to parse season/episode from URL:', url, error);\n    return { season: null, episode: null };\n  }\n}\n\n/** Read and normalize environment variables */\nconst ENV = {\n  BASE: (process.env.NEXT_PUBLIC_VIDEO_API_BASE || \"\").trim(),\n  E1: (process.env.NEXT_PUBLIC_VIDEO_EMBED_1 || \"https://111movies.com/${type}/${id}/${season}/${episode}?autoplay=1&theme=23ddc36c&autoNext=1\").trim(),\n  E2: (process.env.NEXT_PUBLIC_VIDEO_EMBED_2 || \"https://111movies.com/${type}/${id}?autoplay=1&theme=23ddc36c&autoNext=1\").trim(),\n  E3: (process.env.NEXT_PUBLIC_VIDEO_EMBED_3 || \"\").trim(),\n  E4: (process.env.NEXT_PUBLIC_VIDEO_EMBED_4 || \"\").trim(),\n};\n\n/** Global extra params appended to every embed URL */\nconst EXTRA_PARAMS = (process.env.NEXT_PUBLIC_VIDEO_URL_PARAMS || \"\").trim();\n\n/** Providers list with friendly names (fallback order) */\nconst VIDEO_PROVIDERS = [\n  { name: \"Primary\", value: ENV.E1, priority: 1 },\n  { name: \"Secondary\", value: ENV.E2, priority: 2 },\n  { name: \"Tertiary\", value: ENV.E3, priority: 3 },\n  { name: \"Backup\", value: ENV.E4, priority: 4 },\n  { name: \"Base\", value: ENV.BASE, priority: 5 },\n].filter(p => !!p.value);\n\n/** Extract hostname for friendly server label */\nfunction getServerLabel(url: string): string {\n  try {\n    const hostname = new URL(url).hostname;\n    return hostname.replace(/^www\\./, '');\n  } catch {\n    return 'Unknown Server';\n  }\n}\n\n/** Build the default embed path for base URLs */\nfunction buildEmbedPath(\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number\n): string {\n  if (mediaType === \"movie\") return `/movie/${tmdbId}`;\n  if (season && episode) return `/tv/${tmdbId}/${season}/${episode}`;\n  return `/tv/${tmdbId}`;\n}\n\n/** Check if provider uses template placeholders */\nfunction isTemplate(url: string): boolean {\n  return /\\$\\{(id|type|season|episode)\\}/.test(url);\n}\n\n/** Normalize base URL (remove trailing slash) */\nfunction normalizeBase(url: string): string {\n  return url.endsWith(\"/\") ? url.slice(0, -1) : url;\n}\n\n/** Append query parameters safely */\nfunction appendParams(url: string, params: string): string {\n  if (!params) return url;\n  return url + (url.includes(\"?\") ? \"&\" : \"?\") + params;\n}\n\n/** Build raw URL from template or base provider */\nfunction buildRawUrl(\n  providerValue: string,\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number\n): string {\n  if (isTemplate(providerValue)) {\n    return providerValue\n      .replace(/\\$\\{id\\}/g, String(tmdbId))\n      .replace(/\\$\\{type\\}/g, mediaType)\n      .replace(/\\$\\{season\\}/g, season ? String(season) : \"1\")\n      .replace(/\\$\\{episode\\}/g, episode ? String(episode) : \"1\");\n  }\n\n  const base = normalizeBase(providerValue);\n  if (mediaType === \"tv\") {\n    return `${base}/tv/${tmdbId}?s=${season || 1}&e=${episode || 1}`;\n  }\n  return `${base}/movie/${tmdbId}`;\n}\n\n/** Build final playable URL with extra params */\nexport function buildEmbedUrl(\n  providerValue: string,\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number\n): string {\n  const raw = buildRawUrl(providerValue, mediaType, tmdbId, season, episode);\n  return appendParams(raw, EXTRA_PARAMS);\n}\n\n/** Get all embed URL candidates in priority order */\nexport function getEmbedUrlCandidates(\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number\n): string[] {\n  console.log(`üîç Getting embed URL candidates for ${mediaType} ${tmdbId}`, { season, episode });\n\n  const urls = VIDEO_PROVIDERS.map(provider => {\n    const url = buildEmbedUrl(provider.value, mediaType, tmdbId, season, episode);\n    console.log(`üì∫ Generated URL for ${provider.name}: ${url}`);\n    return url;\n  });\n\n  const uniqueUrls = [...new Set(urls)];\n  console.log(`‚úÖ Total unique URLs generated: ${uniqueUrls.length}`);\n\n  return uniqueUrls;\n}\n\n/** Create VideoSource with metadata from provider */\nfunction createVideoSourceWithMetadata(\n  provider: typeof VIDEO_PROVIDERS[0],\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number,\n  title?: string,\n  episodeTitle?: string\n): VideoSource {\n  const url = buildEmbedUrl(provider.value, mediaType, tmdbId, season, episode);\n\n  return {\n    url,\n    quality: \"HD\",\n    type: \"iframe\",\n    servers: `${provider.name} (${getServerLabel(url)})`,\n    tmdbId,\n    mediaType,\n    season,\n    episode,\n    title,\n    episodeTitle,\n  };\n}\n\n/** Resolve TMDB ID from various input formats */\nexport async function resolveTmdbId(\n  input: string | number,\n  type: \"movie\" | \"tv\"\n): Promise<number | null> {\n  if (typeof input === \"number\" && Number.isFinite(input)) return input;\n\n  const str = String(input).trim();\n  const asNum = Number(str);\n  if (Number.isFinite(asNum)) return asNum;\n\n  // Handle IMDb IDs\n  if (/^tt\\d+$/i.test(str)) {\n    const API_KEY = process.env.NEXT_PUBLIC_TMDB_API_KEY?.trim();\n    if (!API_KEY) return null;\n\n    try {\n      const { data } = await axios.get(\n        `https://api.themoviedb.org/3/find/${str}`,\n        {\n          params: { api_key: API_KEY, external_source: \"imdb_id\" },\n          timeout: 5000\n        }\n      );\n\n      const results = type === \"movie\" ? data.movie_results : data.tv_results;\n      return results?.[0]?.id ?? null;\n    } catch (error) {\n      console.error('Failed to resolve IMDb ID:', error);\n      return null;\n    }\n  }\n\n  return null;\n}\n\nexport const videoApi = {\n  /** Check if any video APIs are configured */\n  hasConfiguredApis(): boolean {\n    return VIDEO_PROVIDERS.length > 0;\n  },\n\n  /** Get configuration status for debugging */\n  getConfigStatus() {\n    return {\n      configured: VIDEO_PROVIDERS.length,\n      providers: VIDEO_PROVIDERS.map(p => ({\n        name: p.name,\n        configured: !!p.value,\n        isTemplate: isTemplate(p.value),\n        priority: p.priority\n      })),\n      extraParams: EXTRA_PARAMS || 'none'\n    };\n  },\n\n  /** Get all embed URL candidates for media - ATTACHED to videoApi object */\n  getEmbedUrlCandidates(\n    mediaType: \"movie\" | \"tv\",\n    tmdbId: number,\n    season?: number,\n    episode?: number\n  ): string[] {\n    console.log(`üé¨ videoApi.getEmbedUrlCandidates called:`, { mediaType, tmdbId, season, episode });\n    return getEmbedUrlCandidates(mediaType, tmdbId, season, episode);\n  },\n\n  /** Get movie video sources with metadata */\n  async getMovieSources(tmdbId: number): Promise<VideoSource[]> {\n    console.log(`üé¨ Getting movie sources for TMDB ID: ${tmdbId}`);\n    const API_KEY = process.env.NEXT_PUBLIC_TMDB_API_KEY?.trim();\n    let movieTitle = 'Unknown Movie';\n\n    if (API_KEY) {\n      try {\n        const response = await axios.get(`https://api.themoviedb.org/3/movie/${tmdbId}`, {\n          params: { api_key: API_KEY },\n          timeout: 5000\n        });\n        movieTitle = response.data?.title || movieTitle;\n        console.log(`üìΩÔ∏è Movie title: ${movieTitle}`);\n      } catch (error) {\n        console.warn('Failed to fetch movie title:', error);\n      }\n    }\n\n    const sources = VIDEO_PROVIDERS.map(provider =>\n      createVideoSourceWithMetadata(provider, \"movie\", tmdbId, undefined, undefined, movieTitle)\n    );\n\n    console.log(`‚úÖ Generated ${sources.length} movie sources`);\n    return sources;\n  },\n\n  /** Get TV show video sources with metadata */\n  async getTVSources(\n    tmdbId: number,\n    season?: number,\n    episode?: number\n  ): Promise<VideoSource[]> {\n    console.log(`üì∫ Getting TV sources for TMDB ID: ${tmdbId}, S${season}E${episode}`);\n    const API_KEY = process.env.NEXT_PUBLIC_TMDB_API_KEY?.trim();\n    let showTitle = 'Unknown Show';\n    let episodeTitle = `Episode ${episode || 1}`;\n\n    if (API_KEY && season && episode) {\n      try {\n        const [tvResponse, episodeResponse] = await Promise.allSettled([\n          axios.get(`https://api.themoviedb.org/3/tv/${tmdbId}`, {\n            params: { api_key: API_KEY },\n            timeout: 5000\n          }),\n          axios.get(`https://api.themoviedb.org/3/tv/${tmdbId}/season/${season}/episode/${episode}`, {\n            params: { api_key: API_KEY },\n            timeout: 5000\n          })\n        ]);\n\n        if (tvResponse.status === 'fulfilled') {\n          showTitle = tvResponse.value.data?.name || showTitle;\n          console.log(`üì∫ Show title: ${showTitle}`);\n        }\n\n        if (episodeResponse.status === 'fulfilled') {\n          episodeTitle = episodeResponse.value.data?.name || episodeTitle;\n          console.log(`üé≠ Episode title: ${episodeTitle}`);\n        }\n      } catch (error) {\n        console.warn('Failed to fetch TV metadata:', error);\n      }\n    } else if (API_KEY) {\n      // Just fetch show title\n      try {\n        const response = await axios.get(`https://api.themoviedb.org/3/tv/${tmdbId}`, {\n          params: { api_key: API_KEY },\n          timeout: 5000\n        });\n        showTitle = response.data?.name || showTitle;\n        console.log(`üì∫ Show title: ${showTitle}`);\n      } catch (error) {\n        console.warn('Failed to fetch show title:', error);\n      }\n    }\n\n    const sources = VIDEO_PROVIDERS.map(provider =>\n      createVideoSourceWithMetadata(\n        provider,\n        \"tv\",\n        tmdbId,\n        season,\n        episode,\n        showTitle,\n        episodeTitle\n      )\n    );\n\n    console.log(`‚úÖ Generated ${sources.length} TV sources`);\n    return sources;\n  },\n\n  /** Debug helper to log all configured providers */\n  logConfiguration() {\n    console.log('üìä Video API Configuration:', this.getConfigStatus());\n    console.log('üîß Available methods:', Object.keys(this));\n    console.log('üîç getEmbedUrlCandidates available:', typeof this.getEmbedUrlCandidates === 'function');\n  }\n};\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 292, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/components/player/VideoPlayer.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { videoApi, parseSeasonEpisodeFromUrl } from '@/lib/api/video-api';\nimport type { VideoSource } from '@/lib/api/video-api';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { ArrowLeft } from 'lucide-react';\n\ninterface VideoPlayerProps {\n  mediaId: number;\n  mediaType: 'movie' | 'tv';\n  title?: string;\n  season?: number;\n  episode?: number;\n  onClose?: () => void;\n  loadTimeoutMs?: number;\n  showControls?: boolean;\n}\n\nexport default function VideoPlayer({\n  mediaId,\n  mediaType,\n  title,\n  season,\n  episode,\n  onClose,\n  loadTimeoutMs = 7000,\n  showControls = true\n}: VideoPlayerProps) {\n  const [embedUrl, setEmbedUrl] = useState<string>('');\n  const [candidateUrls, setCandidateUrls] = useState<string[]>([]);\n  const [sources, setSources] = useState<VideoSource[]>([]);\n  const [currentSourceIndex, setCurrentSourceIndex] = useState(0);\n  const [error, setError] = useState<string | null>(null);\n  const [iframeKey, setIframeKey] = useState(0);\n\n  const [currentSeason, setCurrentSeason] = useState<number | undefined>(season);\n  const [currentEpisode, setCurrentEpisode] = useState<number | undefined>(episode);\n  const [showTitle, setShowTitle] = useState<string>(title || '');\n\n  const iframeRef = useRef<HTMLIFrameElement | null>(null);\n  const attemptIdRef = useRef(0); // increments for each tryIndex call\n  const timeoutHandleRef = useRef<number | null>(null);\n  const failedSetRef = useRef<Set<number>>(new Set());\n  const exhaustedRef = useRef(false);\n\n  const router = useRouter();\n  const searchParams = useSearchParams();\n\n  // parse season/episode from URL params if tv\n  useEffect(() => {\n    if (mediaType === 'tv') {\n      const urlSeason = searchParams.get('season');\n      const urlEpisode = searchParams.get('episode');\n      if (urlSeason && urlEpisode) {\n        setCurrentSeason(parseInt(urlSeason));\n        setCurrentEpisode(parseInt(urlEpisode));\n      }\n    }\n  }, [searchParams, mediaType]);\n\n  // auto-next episode (approx runtime fallback)\n  useEffect(() => {\n    if (mediaType !== 'tv' || !currentEpisode || !currentSeason) return;\n    const runtimeMs = 25 * 60 * 1000; // 25 minutes fallback\n    const timer = setTimeout(() => {\n      const nextEpisode = (currentEpisode || 1) + 1;\n      router.replace(`/watch/tv/${mediaId}?season=${currentSeason}&episode=${nextEpisode}`, { scroll: false });\n      setCurrentEpisode(nextEpisode);\n      setIframeKey(k => k + 1);\n    }, runtimeMs);\n\n    return () => clearTimeout(timer);\n  }, [currentEpisode, currentSeason, mediaId, mediaType, router]);\n\n  // clear current attempt timeout\n  const clearAttemptTimeout = useCallback(() => {\n    if (timeoutHandleRef.current !== null) {\n      window.clearTimeout(timeoutHandleRef.current);\n      timeoutHandleRef.current = null;\n    }\n  }, []);\n\n  // pick next index that isn't failed yet; return -1 if none\n  const pickNextIndex = useCallback((): number => {\n    const len = candidateUrls.length;\n    if (len === 0) return -1;\n    for (let i = 1; i <= len; i++) {\n      const idx = (currentSourceIndex + i) % len;\n      if (!failedSetRef.current.has(idx)) return idx;\n    }\n    return -1;\n  }, [candidateUrls.length, currentSourceIndex]);\n\n  // start attempt timeout for an index; uses attemptIdRef to avoid stale timeouts acting\n  const startAttempt = useCallback((idx: number) => {\n    clearAttemptTimeout();\n    attemptIdRef.current += 1;\n    const thisAttemptId = attemptIdRef.current;\n\n    timeoutHandleRef.current = window.setTimeout(() => {\n      // if attempt id still matches, this attempt timed out\n      if (attemptIdRef.current === thisAttemptId) {\n        console.warn(`Attempt ${thisAttemptId} timed out for index ${idx}`);\n        failedSetRef.current.add(idx);\n        const next = pickNextIndex();\n        if (next === -1) {\n          exhaustedRef.current = true;\n          setError('All video sources failed to load');\n          clearAttemptTimeout();\n        } else {\n          tryIndex(next);\n        }\n      }\n    }, loadTimeoutMs) as unknown as number;\n  }, [clearAttemptTimeout, loadTimeoutMs, pickNextIndex]);\n\n  // attempt to switch to index: sets embedUrl and starts attempt\n  const tryIndex = useCallback((idx: number) => {\n    if (!candidateUrls || candidateUrls.length === 0) {\n      setError('No video sources available');\n      return false;\n    }\n    if (idx < 0 || idx >= candidateUrls.length) return false;\n\n    // if idx already failed but others exist, pick next available\n    if (failedSetRef.current.has(idx) && failedSetRef.current.size < candidateUrls.length) {\n      const alt = pickNextIndex();\n      if (alt === -1) {\n        exhaustedRef.current = true;\n        setError('All video sources failed to load');\n        return false;\n      }\n      idx = alt;\n    }\n\n    const url = candidateUrls[idx];\n    console.log(`Attempting source ${idx + 1}/${candidateUrls.length}: ${url}`);\n    setCurrentSourceIndex(idx);\n    setEmbedUrl(url);\n    setIframeKey(k => k + 1);\n    setError(null);\n    startAttempt(idx);\n    return true;\n  }, [candidateUrls, pickNextIndex, startAttempt]);\n\n  // try next available\n  const tryNext = useCallback(() => {\n    if (!candidateUrls || candidateUrls.length === 0) {\n      setError('No video sources available');\n      return false;\n    }\n    if (exhaustedRef.current) {\n      setError('All video sources failed to load');\n      return false;\n    }\n    const next = pickNextIndex();\n    if (next === -1) {\n      exhaustedRef.current = true;\n      setError('All video sources failed to load');\n      clearAttemptTimeout();\n      return false;\n    }\n    return tryIndex(next);\n  }, [candidateUrls, pickNextIndex, tryIndex, clearAttemptTimeout]);\n\n  // try previous (manual): allow overriding failedSet\n  const tryPrev = useCallback(() => {\n    if (!candidateUrls || candidateUrls.length === 0) return;\n    const prev = (currentSourceIndex - 1 + candidateUrls.length) % candidateUrls.length;\n    failedSetRef.current.delete(prev);\n    tryIndex(prev);\n  }, [candidateUrls, currentSourceIndex, tryIndex]);\n\n  // iframe events\n  const handleIframeLoad = useCallback(() => {\n    console.log(`Iframe onLoad for index ${currentSourceIndex}`);\n    clearAttemptTimeout();\n    attemptIdRef.current = 0;\n    failedSetRef.current.delete(currentSourceIndex);\n    exhaustedRef.current = false;\n    setError(null);\n  }, [currentSourceIndex, clearAttemptTimeout]);\n\n  const handleIframeError = useCallback(() => {\n    console.warn(`Iframe onError for index ${currentSourceIndex}`);\n    clearAttemptTimeout();\n    attemptIdRef.current = 0;\n    failedSetRef.current.add(currentSourceIndex);\n    const next = pickNextIndex();\n    if (next === -1) {\n      exhaustedRef.current = true;\n      setError('All video sources failed to load');\n    } else {\n      tryIndex(next);\n    }\n  }, [currentSourceIndex, clearAttemptTimeout, pickNextIndex, tryIndex]);\n\n  // load candidates from server, fallback to videoApi\n  useEffect(() => {\n    let cancelled = false;\n\n    const loadCandidates = async () => {\n      setCandidateUrls([]);\n      setSources([]);\n      setEmbedUrl('');\n      setCurrentSourceIndex(0);\n      exhaustedRef.current = false;\n      failedSetRef.current.clear();\n      setError(null);\n\n      try {\n        // try check-embed endpoint (returns list only)\n        try {\n          const res = await fetch('/api/check-embed', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              mediaType,\n              tmdbId: mediaId,\n              season: currentSeason || season || 1,\n              episode: currentEpisode || episode || 1\n            })\n          });\n\n          if (res.ok) {\n            const data = await res.json();\n            const list: string[] = [];\n\n            if (data.workingUrl) {\n              if (typeof data.workingUrl === 'string') list.push(data.workingUrl);\n              else if (typeof data.workingUrl === 'object' && data.workingUrl.url) list.push(data.workingUrl.url);\n            }\n\n            if (Array.isArray(data.urls) && data.urls.length > 0) {\n              for (const u of data.urls) {\n                if (u && !list.includes(u)) list.push(u);\n              }\n            }\n\n            const final = list.filter(Boolean);\n            if (final.length > 0) {\n              if (cancelled) return;\n              setCandidateUrls(final);\n              // immediately start first attempt\n              tryIndex(0);\n              return;\n            }\n          } else {\n            console.warn('check-embed non-OK, falling back');\n          }\n        } catch (err) {\n          console.warn('check-embed failed, falling back', err);\n        }\n\n        // fallback to videoApi\n        const fallback = mediaType === 'movie'\n          ? await videoApi.getMovieSources(mediaId)\n          : await videoApi.getTVSources(mediaId, currentSeason || season || 1, currentEpisode || episode || 1);\n\n        if (cancelled) return;\n        setSources(fallback || []);\n        const fallbackUrls = (fallback || []).map(s => s.url).filter(Boolean);\n        if (fallbackUrls.length === 0) {\n          setError('No video sources available');\n          return;\n        }\n        setCandidateUrls(fallbackUrls);\n        tryIndex(0);\n      } catch (err) {\n        console.error('Failed to load video sources:', err);\n        if (!cancelled) setError('Failed to load video sources');\n      }\n    };\n\n    loadCandidates();\n\n    return () => {\n      cancelled = true;\n      clearAttemptTimeout();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mediaId, mediaType, currentSeason, currentEpisode]);\n\n  // UI close\n  const handleClose = useCallback(() => {\n    if (onClose) onClose();\n    else router.push('/');\n  }, [onClose, router]);\n\n  // ESC to close\n  useEffect(() => {\n    const onKey = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') handleClose();\n    };\n    document.addEventListener('keydown', onKey);\n    return () => document.removeEventListener('keydown', onKey);\n  }, [handleClose]);\n\n  // cleanup timeout on unmount\n  useEffect(() => {\n    return () => clearAttemptTimeout();\n  }, [clearAttemptTimeout]);\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black\">\n      {/* Player */}\n      {embedUrl && !error && (\n        <>\n          <iframe\n            key={iframeKey}\n            ref={iframeRef}\n            src={embedUrl}\n            className=\"w-full h-full\"\n            allowFullScreen\n            allow=\"autoplay; encrypted-media; picture-in-picture\"\n            onLoad={handleIframeLoad}\n            onError={handleIframeError}\n            style={{ border: 'none' }}\n            title={title || `player-${mediaType}-${mediaId}`}\n          />\n\n          {/* Back + Title */}\n          <div className=\"absolute top-4 left-4 z-30 flex items-center gap-3\">\n            <button\n              onClick={handleClose}\n              className=\"p-2 rounded-full bg-black/60 text-white\"\n              aria-label=\"Back\"\n            >\n              <ArrowLeft className=\"w-6 h-6\" />\n            </button>\n            {showTitle && (\n              <h1 className=\"text-white font-extrabold text-lg truncate max-w-xs\">\n                {showTitle}\n              </h1>\n            )}\n          </div>\n\n          {/* Season/Episode */}\n          {mediaType === 'tv' && currentSeason && currentEpisode && (\n            <div className=\"absolute top-4 left-1/2 -translate-x-1/2 bg-black/60 px-4 py-1 rounded-md text-white\">\n              S{currentSeason}E{currentEpisode}\n            </div>\n          )}\n\n          {/* Controls overlay */}\n          <div className=\"absolute top-4 right-4 z-30 text-white/80 text-sm flex items-center gap-3\">\n            <div>Auto-switch enabled ‚Äî Press ESC to exit</div>\n            <div className=\"text-xs ml-2\">Source {currentSourceIndex + 1}/{candidateUrls.length || 0}</div>\n            {showControls && candidateUrls.length > 0 && (\n              <div className=\"ml-3 flex items-center gap-2\">\n                <button onClick={tryPrev} className=\"px-2 py-1 bg-black/60 rounded hover:bg-black/80\">Prev</button>\n                <button onClick={tryNext} className=\"px-2 py-1 bg-black/60 rounded hover:bg-black/80\">Next</button>\n              </div>\n            )}\n          </div>\n        </>\n      )}\n\n      {/* Error */}\n      {error && (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"text-white text-center max-w-md px-6\">\n            <div className=\"text-6xl mb-6\">‚ö†Ô∏è</div>\n            <h2 className=\"text-2xl font-bold mb-4\">Unable to Play Video</h2>\n            <p className=\"text-gray-300 mb-4\">{error}</p>\n            <div className=\"flex items-center justify-center gap-3\">\n              <button onClick={handleClose} className=\"px-6 py-2 bg-gray-700 rounded\">Go Back</button>\n              {candidateUrls.length > 0 && <button onClick={() => tryIndex(0)} className=\"px-6 py-2 bg-gray-600 rounded\">Retry</button>}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Nothing */}\n      {!embedUrl && !error && (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"text-white text-center\">\n            <div className=\"text-4xl mb-4\">üì∫</div>\n            <h2 className=\"text-xl font-bold mb-2\">No Video Sources Available</h2>\n            <p className=\"text-gray-400 mb-6\">Unable to find any playable video sources for this content</p>\n            <button onClick={handleClose} className=\"px-8 py-3 bg-gray-700 hover:bg-gray-600 rounded-lg\">Go Back</button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 854, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/app/watch/%5Bmediatype%5D/%5Bid%5D/page.tsx"],"sourcesContent":["// app/watch/[mediatype]/[id]/page.tsx\n'use client';\n\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport VideoPlayer from '@/components/player/VideoPlayer';\nimport { tmdbApi } from '@/lib/api/tmdb';\n\nexport default function WatchPage() {\n  const params = useParams();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [mediaData, setMediaData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  const mediaType = params?.mediatype as 'movie' | 'tv';\n  const id = parseInt(params?.id as string);\n  \n  // Get season and episode from query params for TV shows\n  const season = parseInt(searchParams.get('season') || '1');\n  const episode = parseInt(searchParams.get('episode') || '1');\n\n  useEffect(() => {\n    // Hide body scroll for fullscreen experience\n    document.body.style.overflow = 'hidden';\n    \n    return () => {\n      document.body.style.overflow = 'auto';\n    };\n  }, []);\n\n  useEffect(() => {\n    async function loadMediaData() {\n      try {\n        let data;\n        if (mediaType === 'movie') {\n          data = await tmdbApi.getMovieDetails(id);\n        } else {\n          data = await tmdbApi.getTVShowDetails(id);\n        }\n        setMediaData(data);\n      } catch (error) {\n        console.error('Failed to load media:', error);\n      } finally {\n        setLoading(false);\n      }\n    }\n\n    if (id && mediaType) {\n      loadMediaData();\n    }\n  }, [id, mediaType]);\n\n  const handleClose = () => {\n    router.back();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"fixed inset-0 bg-black flex items-center justify-center\">\n        <div className=\"text-white text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-2 border-white border-t-transparent mx-auto mb-4\"></div>\n          <p>Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!mediaData) {\n    return (\n      <div className=\"fixed inset-0 bg-black flex items-center justify-center text-white\">\n        <div className=\"text-center\">\n          <h1 className=\"text-xl font-semibold mb-4\">Media not found</h1>\n          <button\n            onClick={handleClose}\n            className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors\"\n          >\n            Go Back\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  const title = mediaData.title || mediaData.name;\n\n  return (\n    <VideoPlayer\n      mediaId={id}\n      mediaType={mediaType}\n      title={title}\n      season={mediaType === 'tv' ? season : undefined}\n      episode={mediaType === 'tv' ? episode : undefined}\n      onClose={handleClose}\n    />\n  );\n}\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;AAGtC;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,eAAe,CAAA,GAAA,kIAAA,CAAA,kBAAe,AAAD;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAO;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,YAAY,QAAQ;IAC1B,MAAM,KAAK,SAAS,QAAQ;IAE5B,wDAAwD;IACxD,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa;IACtD,MAAM,UAAU,SAAS,aAAa,GAAG,CAAC,cAAc;IAExD,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,6CAA6C;QAC7C,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAE/B,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QACjC;IACF,GAAG,EAAE;IAEL,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,eAAe;YACb,IAAI;gBACF,IAAI;gBACJ,IAAI,cAAc,SAAS;oBACzB,OAAO,MAAM,kHAAA,CAAA,UAAO,CAAC,eAAe,CAAC;gBACvC,OAAO;oBACL,OAAO,MAAM,kHAAA,CAAA,UAAO,CAAC,gBAAgB,CAAC;gBACxC;gBACA,aAAa;YACf,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yBAAyB;YACzC,SAAU;gBACR,WAAW;YACb;QACF;QAEA,IAAI,MAAM,WAAW;YACnB;QACF;IACF,GAAG;QAAC;QAAI;KAAU;IAElB,MAAM,cAAc;QAClB,OAAO,IAAI;IACb;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;kCAAE;;;;;;;;;;;;;;;;;IAIX;IAEA,IAAI,CAAC,WAAW;QACd,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;IAMT;IAEA,MAAM,QAAQ,UAAU,KAAK,IAAI,UAAU,IAAI;IAE/C,qBACE,8OAAC,oIAAA,CAAA,UAAW;QACV,SAAS;QACT,WAAW;QACX,OAAO;QACP,QAAQ,cAAc,OAAO,SAAS;QACtC,SAAS,cAAc,OAAO,UAAU;QACxC,SAAS;;;;;;AAGf","debugId":null}},
    {"offset": {"line": 998, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/lucide-react/dist/esm/icons/arrow-left.js","sources":["file:///home/flex/Atto4/node_modules/lucide-react/src/icons/arrow-left.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n];\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('arrow-left', __iconNode);\n\nexport default ArrowLeft;\n"],"names":[],"mappings":";;;;;;;;;;;AAGO,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,UAAA,CAAA,CAAA,CAAuB;IAClC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAkB,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IAC/C;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;CAC3C;AAaA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,SAAA,CAAA,CAAA,wKAAY,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAiB,CAAjB,AAAiB,CAAjB,AAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAc,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA","debugId":null}}]
}