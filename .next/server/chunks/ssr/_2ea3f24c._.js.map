{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/lib/hooks/useEmbedAutoSwitch.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useEffect, useRef, useState } from 'react';\nimport { getMovieSources, getTVSources } from '@/lib/api/video-api';\n\ntype MediaType = 'movie' | 'tv';\n\ntype ServerResult =\n  | string\n  | { url: string; working?: boolean; responseTimeMs?: number; status?: number; probe?: 'HEAD'|'GET' };\n\ninterface UseEmbedAutoSwitchArgs {\n  mediaType: MediaType;\n  mediaId: number;\n  season?: number;\n  episode?: number;\n  guardMs?: number;          // iframe load guard (auto switch) — default 6000\n  preferServer?: boolean;    // use /api/check-embed first — default true\n}\n\nexport function useEmbedAutoSwitch({\n  mediaType,\n  mediaId,\n  season,\n  episode,\n  guardMs = 6000,\n  preferServer = true,\n}: UseEmbedAutoSwitchArgs) {\n  const [candidates, setCandidates] = useState<string[]>([]);\n  const [index, setIndex] = useState(0);\n  const [src, setSrc] = useState<string>('');\n  const failed = useRef<Set<number>>(new Set());\n  const timer = useRef<number | null>(null);\n  const attemptId = useRef(0);\n  const mounted = useRef(true);\n\n  const clearGuard = useCallback(() => {\n    if (timer.current != null) {\n      window.clearTimeout(timer.current);\n      timer.current = null;\n    }\n  }, []);\n\n  const startGuard = useCallback((i: number) => {\n    clearGuard();\n    const thisAttempt = ++attemptId.current;\n    timer.current = window.setTimeout(() => {\n      // if still same attempt and not loaded — mark failed & next\n      if (attemptId.current === thisAttempt) {\n        failed.current.add(i);\n        // try next\n        let next = -1;\n        for (let step = 1; step <= candidates.length; step++) {\n          const cand = (i + step) % candidates.length;\n          if (!failed.current.has(cand)) { next = cand; break; }\n        }\n        if (next >= 0) {\n          setIndex(next);\n          setSrc(candidates[next]);\n          startGuard(next);\n        }\n      }\n    }, guardMs) as unknown as number;\n  }, [candidates, guardMs, clearGuard]);\n\n  // load candidate list\n  useEffect(() => {\n    mounted.current = true;\n    failed.current.clear();\n    setCandidates([]);\n    setIndex(0);\n    setSrc('');\n\n    (async () => {\n      let list: string[] = [];\n\n      // 1) server-probed list\n      if (preferServer) {\n        try {\n          const res = await fetch('/api/check-embed', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              mediaType,\n              tmdbId: mediaId,\n              season: season || 1,\n              episode: episode || 1,\n              timeoutMs: 4000,\n              retries: 0,\n            }),\n          });\n\n          if (res.ok) {\n            const data = await res.json();\n            // Accept either plain string array or array of objects\n            const urls: ServerResult[] = Array.isArray(data.urls) ? data.urls : [];\n            const normalized = urls.map(u => (typeof u === 'string' ? u : u?.url)).filter(Boolean) as string[];\n            // Put workingUrl first if present and not already at front\n            const first = typeof data.workingUrl === 'string' ? data.workingUrl : (data.workingUrl?.url ?? null);\n            if (first) {\n              list = [first, ...normalized.filter(u => u !== first)];\n            } else {\n              list = normalized;\n            }\n          }\n        } catch {\n          // ignore; fallback below\n        }\n      }\n\n      // 2) fallback to local providers if needed\n      if (list.length === 0) {\n        const fallback = mediaType === 'movie'\n          ? await getMovieSources(mediaId)\n          : await getTVSources(mediaId, season || 1, episode || 1);\n        list = (fallback || []).map(s => s.url).filter(Boolean);\n      }\n\n      list = Array.from(new Set(list)); // unique in order\n\n      if (!mounted.current) return;\n\n      setCandidates(list);\n      if (list.length > 0) {\n        setIndex(0);\n        setSrc(list[0]);\n        startGuard(0);\n      }\n    })();\n\n    return () => {\n      mounted.current = false;\n      clearGuard();\n    };\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [mediaId, mediaType, season, episode, preferServer, guardMs]);\n\n  const onLoad = useCallback(() => {\n    clearGuard();\n    // current index succeeded; clear failure flag\n    failed.current.delete(index);\n  }, [index, clearGuard]);\n\n  const onError = useCallback(() => {\n    clearGuard();\n    failed.current.add(index);\n    // pick next\n    let next = -1;\n    for (let step = 1; step <= candidates.length; step++) {\n      const cand = (index + step) % candidates.length;\n      if (!failed.current.has(cand)) { next = cand; break; }\n    }\n    if (next >= 0) {\n      setIndex(next);\n      setSrc(candidates[next]);\n      startGuard(next);\n    }\n  }, [index, candidates, clearGuard, startGuard]);\n\n  // optional manual controls\n  const next = useCallback(() => {\n    clearGuard();\n    let nextIdx = -1;\n    for (let step = 1; step <= candidates.length; step++) {\n      const cand = (index + step) % candidates.length;\n      if (!failed.current.has(cand)) { nextIdx = cand; break; }\n    }\n    if (nextIdx >= 0) {\n      setIndex(nextIdx);\n      setSrc(candidates[nextIdx]);\n      startGuard(nextIdx);\n    }\n  }, [index, candidates, clearGuard, startGuard]);\n\n  const prev = useCallback(() => {\n    clearGuard();\n    let prevIdx = -1;\n    for (let step = 1; step <= candidates.length; step++) {\n      const cand = (index - step + candidates.length) % candidates.length;\n      if (!failed.current.has(cand)) { prevIdx = cand; break; }\n    }\n    if (prevIdx >= 0) {\n      setIndex(prevIdx);\n      setSrc(candidates[prevIdx]);\n      startGuard(prevIdx);\n    }\n  }, [index, candidates, clearGuard, startGuard]);\n\n  return {\n    src,\n    index,\n    total: candidates.length,\n    onLoad,\n    onError,\n    next,\n    prev,\n    setIndex, // if you want to jump\n  };\n}\n"],"names":[],"mappings":";;;AAEA;;;;;;AAFA;;;AAoBO,SAAS,mBAAmB,EACjC,SAAS,EACT,OAAO,EACP,MAAM,EACN,OAAO,EACP,UAAU,IAAI,EACd,eAAe,IAAI,EACI;IACvB,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IACzD,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,KAAK,OAAO,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU;IACvC,MAAM,SAAS,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAe,IAAI;IACvC,MAAM,QAAQ,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAiB;IACpC,MAAM,YAAY,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAE;IACzB,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,SAAM,AAAD,EAAE;IAEvB,MAAM,aAAa,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC7B,IAAI,MAAM,OAAO,IAAI,MAAM;YACzB,OAAO,YAAY,CAAC,MAAM,OAAO;YACjC,MAAM,OAAO,GAAG;QAClB;IACF,GAAG,EAAE;IAEL,MAAM,aAAa,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE,CAAC;QAC9B;QACA,MAAM,cAAc,EAAE,UAAU,OAAO;QACvC,MAAM,OAAO,GAAG,OAAO,UAAU,CAAC;YAChC,4DAA4D;YAC5D,IAAI,UAAU,OAAO,KAAK,aAAa;gBACrC,OAAO,OAAO,CAAC,GAAG,CAAC;gBACnB,WAAW;gBACX,IAAI,OAAO,CAAC;gBACZ,IAAK,IAAI,OAAO,GAAG,QAAQ,WAAW,MAAM,EAAE,OAAQ;oBACpD,MAAM,OAAO,CAAC,IAAI,IAAI,IAAI,WAAW,MAAM;oBAC3C,IAAI,CAAC,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO;wBAAE,OAAO;wBAAM;oBAAO;gBACvD;gBACA,IAAI,QAAQ,GAAG;oBACb,SAAS;oBACT,OAAO,UAAU,CAAC,KAAK;oBACvB,WAAW;gBACb;YACF;QACF,GAAG;IACL,GAAG;QAAC;QAAY;QAAS;KAAW;IAEpC,sBAAsB;IACtB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,QAAQ,OAAO,GAAG;QAClB,OAAO,OAAO,CAAC,KAAK;QACpB,cAAc,EAAE;QAChB,SAAS;QACT,OAAO;QAEP,CAAC;YACC,IAAI,OAAiB,EAAE;YAEvB,wBAAwB;YACxB,IAAI,cAAc;gBAChB,IAAI;oBACF,MAAM,MAAM,MAAM,MAAM,oBAAoB;wBAC1C,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BACnB;4BACA,QAAQ;4BACR,QAAQ,UAAU;4BAClB,SAAS,WAAW;4BACpB,WAAW;4BACX,SAAS;wBACX;oBACF;oBAEA,IAAI,IAAI,EAAE,EAAE;wBACV,MAAM,OAAO,MAAM,IAAI,IAAI;wBAC3B,uDAAuD;wBACvD,MAAM,OAAuB,MAAM,OAAO,CAAC,KAAK,IAAI,IAAI,KAAK,IAAI,GAAG,EAAE;wBACtE,MAAM,aAAa,KAAK,GAAG,CAAC,CAAA,IAAM,OAAO,MAAM,WAAW,IAAI,GAAG,KAAM,MAAM,CAAC;wBAC9E,2DAA2D;wBAC3D,MAAM,QAAQ,OAAO,KAAK,UAAU,KAAK,WAAW,KAAK,UAAU,GAAI,KAAK,UAAU,EAAE,OAAO;wBAC/F,IAAI,OAAO;4BACT,OAAO;gCAAC;mCAAU,WAAW,MAAM,CAAC,CAAA,IAAK,MAAM;6BAAO;wBACxD,OAAO;4BACL,OAAO;wBACT;oBACF;gBACF,EAAE,OAAM;gBACN,yBAAyB;gBAC3B;YACF;YAEA,2CAA2C;YAC3C,IAAI,KAAK,MAAM,KAAK,GAAG;gBACrB,MAAM,WAAW,cAAc,UAC3B,MAAM,gBAAgB,WACtB,MAAM,aAAa,SAAS,UAAU,GAAG,WAAW;gBACxD,OAAO,CAAC,YAAY,EAAE,EAAE,GAAG,CAAC,CAAA,IAAK,EAAE,GAAG,EAAE,MAAM,CAAC;YACjD;YAEA,OAAO,MAAM,IAAI,CAAC,IAAI,IAAI,QAAQ,kBAAkB;YAEpD,IAAI,CAAC,QAAQ,OAAO,EAAE;YAEtB,cAAc;YACd,IAAI,KAAK,MAAM,GAAG,GAAG;gBACnB,SAAS;gBACT,OAAO,IAAI,CAAC,EAAE;gBACd,WAAW;YACb;QACF,CAAC;QAED,OAAO;YACL,QAAQ,OAAO,GAAG;YAClB;QACF;IACF,uDAAuD;IACvD,GAAG;QAAC;QAAS;QAAW;QAAQ;QAAS;QAAc;KAAQ;IAE/D,MAAM,SAAS,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACzB;QACA,8CAA8C;QAC9C,OAAO,OAAO,CAAC,MAAM,CAAC;IACxB,GAAG;QAAC;QAAO;KAAW;IAEtB,MAAM,UAAU,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QAC1B;QACA,OAAO,OAAO,CAAC,GAAG,CAAC;QACnB,YAAY;QACZ,IAAI,OAAO,CAAC;QACZ,IAAK,IAAI,OAAO,GAAG,QAAQ,WAAW,MAAM,EAAE,OAAQ;YACpD,MAAM,OAAO,CAAC,QAAQ,IAAI,IAAI,WAAW,MAAM;YAC/C,IAAI,CAAC,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO;gBAAE,OAAO;gBAAM;YAAO;QACvD;QACA,IAAI,QAAQ,GAAG;YACb,SAAS;YACT,OAAO,UAAU,CAAC,KAAK;YACvB,WAAW;QACb;IACF,GAAG;QAAC;QAAO;QAAY;QAAY;KAAW;IAE9C,2BAA2B;IAC3B,MAAM,OAAO,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACvB;QACA,IAAI,UAAU,CAAC;QACf,IAAK,IAAI,OAAO,GAAG,QAAQ,WAAW,MAAM,EAAE,OAAQ;YACpD,MAAM,OAAO,CAAC,QAAQ,IAAI,IAAI,WAAW,MAAM;YAC/C,IAAI,CAAC,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO;gBAAE,UAAU;gBAAM;YAAO;QAC1D;QACA,IAAI,WAAW,GAAG;YAChB,SAAS;YACT,OAAO,UAAU,CAAC,QAAQ;YAC1B,WAAW;QACb;IACF,GAAG;QAAC;QAAO;QAAY;QAAY;KAAW;IAE9C,MAAM,OAAO,CAAA,GAAA,qMAAA,CAAA,cAAW,AAAD,EAAE;QACvB;QACA,IAAI,UAAU,CAAC;QACf,IAAK,IAAI,OAAO,GAAG,QAAQ,WAAW,MAAM,EAAE,OAAQ;YACpD,MAAM,OAAO,CAAC,QAAQ,OAAO,WAAW,MAAM,IAAI,WAAW,MAAM;YACnE,IAAI,CAAC,OAAO,OAAO,CAAC,GAAG,CAAC,OAAO;gBAAE,UAAU;gBAAM;YAAO;QAC1D;QACA,IAAI,WAAW,GAAG;YAChB,SAAS;YACT,OAAO,UAAU,CAAC,QAAQ;YAC1B,WAAW;QACb;IACF,GAAG;QAAC;QAAO;QAAY;QAAY;KAAW;IAE9C,OAAO;QACL;QACA;QACA,OAAO,WAAW,MAAM;QACxB;QACA;QACA;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/components/players/MoviePlayer.tsx"],"sourcesContent":["'use client';\n\nimport { useRouter } from 'next/navigation';\nimport { ArrowLeft } from 'lucide-react';\nimport { useEmbedAutoSwitch } from '@/lib/hooks/useEmbedAutoSwitch';\n\ninterface MoviePlayerProps {\n  mediaId: number;\n  title?: string;\n  onClose?: () => void;\n  guardMs?: number;\n  showControls?: boolean;\n}\n\nexport default function MoviePlayer({\n  mediaId,\n  title,\n  onClose,\n  guardMs = 6000,\n  showControls = true,\n}: MoviePlayerProps) {\n  const router = useRouter();\n  const { src, index, total, onLoad, onError, next, prev } = useEmbedAutoSwitch({\n    mediaType: 'movie',\n    mediaId,\n    guardMs,\n    preferServer: true,\n  });\n\n  const handleClose = () => (onClose ? onClose() : router.back());\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black\">\n      {src ? (\n        <>\n          <iframe\n            key={src}\n            src={src}\n            className=\"w-full h-full\"\n            allowFullScreen\n            allow=\"autoplay; encrypted-media; picture-in-picture\"\n            onLoad={onLoad}\n            onError={onError}\n            style={{ border: 'none' }}\n            title={title || `movie-${mediaId}`}\n          />\n\n          {/* Back + Title */}\n          <div className=\"absolute top-4 left-4 z-30 flex items-center gap-3\">\n            <button\n              onClick={handleClose}\n              className=\"p-2 rounded-full bg-black/60 text-white\"\n              aria-label=\"Back\"\n            >\n              <ArrowLeft className=\"w-6 h-6\" />\n            </button>\n            {title && (\n              <h1 className=\"text-white font-extrabold text-lg truncate max-w-xs\">{title}</h1>\n            )}\n          </div>\n\n          {/* Minimal overlay */}\n          <div className=\"absolute top-4 right-4 z-30 text-white/80 text-sm flex items-center gap-3\">\n            <div>Auto-switch enabled — Press ESC to exit</div>\n            <div className=\"text-xs ml-2\">Source {index + 1}/{total || 0}</div>\n            {showControls && total > 1 && (\n              <div className=\"ml-3 flex items-center gap-2\">\n                <button onClick={prev} className=\"px-2 py-1 bg-black/60 rounded hover:bg-black/80\">Prev</button>\n                <button onClick={next} className=\"px-2 py-1 bg-black/60 rounded hover:bg-black/80\">Next</button>\n              </div>\n            )}\n          </div>\n        </>\n      ) : (\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <div className=\"text-white/70 text-sm\">Preparing player…</div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAJA;;;;;AAce,SAAS,YAAY,EAClC,OAAO,EACP,KAAK,EACL,OAAO,EACP,UAAU,IAAI,EACd,eAAe,IAAI,EACF;IACjB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,EAAE,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,kIAAA,CAAA,qBAAkB,AAAD,EAAE;QAC5E,WAAW;QACX;QACA;QACA,cAAc;IAChB;IAEA,MAAM,cAAc,IAAO,UAAU,YAAY,OAAO,IAAI;IAE5D,qBACE,8OAAC;QAAI,WAAU;kBACZ,oBACC;;8BACE,8OAAC;oBAEC,KAAK;oBACL,WAAU;oBACV,eAAe;oBACf,OAAM;oBACN,QAAQ;oBACR,SAAS;oBACT,OAAO;wBAAE,QAAQ;oBAAO;oBACxB,OAAO,SAAS,CAAC,MAAM,EAAE,SAAS;mBAR7B;;;;;8BAYP,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,SAAS;4BACT,WAAU;4BACV,cAAW;sCAEX,cAAA,8OAAC,gNAAA,CAAA,YAAS;gCAAC,WAAU;;;;;;;;;;;wBAEtB,uBACC,8OAAC;4BAAG,WAAU;sCAAuD;;;;;;;;;;;;8BAKzE,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;sCAAI;;;;;;sCACL,8OAAC;4BAAI,WAAU;;gCAAe;gCAAQ,QAAQ;gCAAE;gCAAE,SAAS;;;;;;;wBAC1D,gBAAgB,QAAQ,mBACvB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAO,SAAS;oCAAM,WAAU;8CAAkD;;;;;;8CACnF,8OAAC;oCAAO,SAAS;oCAAM,WAAU;8CAAkD;;;;;;;;;;;;;;;;;;;yCAM3F,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAwB;;;;;;;;;;;;;;;;AAKjD","debugId":null}},
    {"offset": {"line": 377, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/lib/api/video-common.ts"],"sourcesContent":["import axios from 'axios';\n\nexport function getServerLabel(url: string): string {\n  if (!url) return 'Unknown Server';\n  try {\n    const hostname = new URL(url).hostname;\n    return hostname.replace(/^www\\./, '');\n  } catch {\n    return 'Unknown Server';\n  }\n}\n\nexport function buildEmbedUrl(\n  providerValue: string,\n  mediaType: \"movie\" | \"tv\",\n  tmdbId: number,\n  season?: number,\n  episode?: number\n): string {\n  if (!providerValue) throw new Error('Provider URL required');\n\n  // Handle template URLs (${id}, ${season}, ${episode})\n  if (/\\$\\{.*\\}/.test(providerValue)) {\n    return providerValue\n      .replace(/\\$\\{id\\}/g, String(tmdbId))\n      .replace(/\\$\\{type\\}/g, mediaType)\n      .replace(/\\$\\{season\\}/g, String(season || 1))\n      .replace(/\\$\\{episode\\}/g, String(episode || 1));\n  }\n\n  // Handle base URLs - build path\n  const base = providerValue.endsWith('/') ? providerValue.slice(0, -1) : providerValue;\n  if (mediaType === 'movie') {\n    return `${base}/movie/${tmdbId}`;\n  } else {\n    return `${base}/tv/${tmdbId}/${season || 1}/${episode || 1}`;\n  }\n}\n\nexport async function resolveTmdbId(input: string | number, type: \"movie\" | \"tv\"): Promise<number | null> {\n  // Handle numeric input\n  if (typeof input === 'number' && Number.isFinite(input)) return input;\n  \n  const s = String(input).trim();\n  if (!s) return null;\n\n  // Handle string numeric\n  const asNum = Number(s);\n  if (Number.isFinite(asNum)) return asNum;\n\n  // Handle IMDb IDs\n  if (/^tt\\d+$/i.test(s)) {\n    const API_KEY = process.env.NEXT_PUBLIC_TMDB_API_KEY?.trim();\n    if (!API_KEY) {\n      console.warn('TMDB API key required for IMDb ID resolution');\n      return null;\n    }\n    \n    try {\n      const { data } = await axios.get(`https://api.themoviedb.org/3/find/${s}`, {\n        params: { api_key: API_KEY, external_source: 'imdb_id' },\n        timeout: 5000\n      });\n      \n      const results = type === 'movie' ? data.movie_results : data.tv_results;\n      return results?.[0]?.id ?? null;\n    } catch (err) {\n      console.warn('IMDb ID resolution failed:', err);\n      return null;\n    }\n  }\n  \n  return null;\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAEO,SAAS,eAAe,GAAW;IACxC,IAAI,CAAC,KAAK,OAAO;IACjB,IAAI;QACF,MAAM,WAAW,IAAI,IAAI,KAAK,QAAQ;QACtC,OAAO,SAAS,OAAO,CAAC,UAAU;IACpC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEO,SAAS,cACd,aAAqB,EACrB,SAAyB,EACzB,MAAc,EACd,MAAe,EACf,OAAgB;IAEhB,IAAI,CAAC,eAAe,MAAM,IAAI,MAAM;IAEpC,sDAAsD;IACtD,IAAI,WAAW,IAAI,CAAC,gBAAgB;QAClC,OAAO,cACJ,OAAO,CAAC,aAAa,OAAO,SAC5B,OAAO,CAAC,eAAe,WACvB,OAAO,CAAC,iBAAiB,OAAO,UAAU,IAC1C,OAAO,CAAC,kBAAkB,OAAO,WAAW;IACjD;IAEA,gCAAgC;IAChC,MAAM,OAAO,cAAc,QAAQ,CAAC,OAAO,cAAc,KAAK,CAAC,GAAG,CAAC,KAAK;IACxE,IAAI,cAAc,SAAS;QACzB,OAAO,GAAG,KAAK,OAAO,EAAE,QAAQ;IAClC,OAAO;QACL,OAAO,GAAG,KAAK,IAAI,EAAE,OAAO,CAAC,EAAE,UAAU,EAAE,CAAC,EAAE,WAAW,GAAG;IAC9D;AACF;AAEO,eAAe,cAAc,KAAsB,EAAE,IAAoB;IAC9E,uBAAuB;IACvB,IAAI,OAAO,UAAU,YAAY,OAAO,QAAQ,CAAC,QAAQ,OAAO;IAEhE,MAAM,IAAI,OAAO,OAAO,IAAI;IAC5B,IAAI,CAAC,GAAG,OAAO;IAEf,wBAAwB;IACxB,MAAM,QAAQ,OAAO;IACrB,IAAI,OAAO,QAAQ,CAAC,QAAQ,OAAO;IAEnC,kBAAkB;IAClB,IAAI,WAAW,IAAI,CAAC,IAAI;QACtB,MAAM,gFAAgD;QACtD,IAAI,CAAC,SAAS;YACZ,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;QAEA,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,qIAAA,CAAA,UAAK,CAAC,GAAG,CAAC,CAAC,kCAAkC,EAAE,GAAG,EAAE;gBACzE,QAAQ;oBAAE,SAAS;oBAAS,iBAAiB;gBAAU;gBACvD,SAAS;YACX;YAEA,MAAM,UAAU,SAAS,UAAU,KAAK,aAAa,GAAG,KAAK,UAAU;YACvE,OAAO,SAAS,CAAC,EAAE,EAAE,MAAM;QAC7B,EAAE,OAAO,KAAK;YACZ,QAAQ,IAAI,CAAC,8BAA8B;YAC3C,OAAO;QACT;IACF;IAEA,OAAO;AACT","debugId":null}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/lib/api/video-tv.ts"],"sourcesContent":["import { getServerLabel } from './video-common';\n\ninterface TVEmbedResult {\n  embedUrl: string;\n  provider: string;\n}\n\nfunction getTVProviders() {\n  const providers = [\n    process.env.NEXT_PUBLIC_TV_EMBED_1 || \"https://cinemaos.tech/player/${id}/${season}/${episode}\",\n    process.env.NEXT_PUBLIC_TV_EMBED_2 || \"\",\n    process.env.NEXT_PUBLIC_TV_EMBED_3 || \"\",\n    process.env.NEXT_PUBLIC_TV_EMBED_4 || \"\",\n    process.env.NEXT_PUBLIC_TV_API_BASE || \"\",\n  ].filter(p => p.trim());\n  \n  return providers.length > 0 ? providers : [\"https://cinemaos.tech/player/${id}/${season}/${episode}\"];\n}\n\n// ✅ FAST: Direct URL building - no validation overhead\nexport function getTVEmbed(id: string | number): TVEmbedResult {\n  const providers = getTVProviders();\n  const providerUrl = providers[0];\n\n  // Direct template replacement - instant\n  const embedUrl = providerUrl\n    .replace(/\\$\\{id\\}/g, String(id))\n    .replace(/\\$\\{season\\}/g, '1')\n    .replace(/\\$\\{episode\\}/g, '1');\n\n  return {\n    embedUrl,\n    provider: getServerLabel(providerUrl)\n  };\n}\n\nexport default { getTVEmbed };\n"],"names":[],"mappings":";;;;AAAA;;AAOA,SAAS;IACP,MAAM,YAAY;QAChB,QAAQ,GAAG,CAAC,sBAAsB,IAAI;QACtC,QAAQ,GAAG,CAAC,sBAAsB,IAAI;QACtC,QAAQ,GAAG,CAAC,sBAAsB,IAAI;QACtC,QAAQ,GAAG,CAAC,sBAAsB,IAAI;QACtC,QAAQ,GAAG,CAAC,uBAAuB,IAAI;KACxC,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,IAAI;IAEpB,OAAO,UAAU,MAAM,GAAG,IAAI,YAAY;QAAC;KAA0D;AACvG;AAGO,SAAS,WAAW,EAAmB;IAC5C,MAAM,YAAY;IAClB,MAAM,cAAc,SAAS,CAAC,EAAE;IAEhC,wCAAwC;IACxC,MAAM,WAAW,YACd,OAAO,CAAC,aAAa,OAAO,KAC5B,OAAO,CAAC,iBAAiB,KACzB,OAAO,CAAC,kBAAkB;IAE7B,OAAO;QACL;QACA,UAAU,CAAA,GAAA,6HAAA,CAAA,iBAAc,AAAD,EAAE;IAC3B;AACF;uCAEe;IAAE;AAAW","debugId":null}},
    {"offset": {"line": 478, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/components/players/TvPlayer.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { ArrowLeft } from 'lucide-react';\nimport { getTVEmbed } from '@/lib/api/video-tv';\n\ninterface TvPlayerProps {\n  mediaId: number | string;\n  title?: string;\n  onClose?: () => void;\n}\n\nexport default function TvPlayer({ mediaId, title, onClose }: TvPlayerProps) {\n  const [embedUrl, setEmbedUrl] = useState<string>('');\n  const [loading, setLoading] = useState(true);\n  \n  const router = useRouter();\n\n  useEffect(() => {\n    // ✅ INSTANT: No async calls, no validation delays\n    const result = getTVEmbed(mediaId);\n    setEmbedUrl(result.embedUrl);\n    setLoading(false);\n    \n    console.log(`TV embed: ${result.embedUrl}`);\n  }, [mediaId]);\n\n  const handleClose = () => onClose ? onClose() : router.back();\n\n  if (loading) {\n    return (\n      <div className=\"fixed inset-0 z-50 bg-black flex items-center justify-center\">\n        <div className=\"text-white\">Loading...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black\">\n      <iframe\n        src={embedUrl}\n        className=\"w-full h-full\"\n        allowFullScreen\n        allow=\"autoplay; encrypted-media; picture-in-picture\"\n        style={{ border: 'none' }}\n      />\n      \n      <div className=\"absolute top-4 left-4 z-30 flex items-center gap-3\">\n        <button\n          onClick={handleClose}\n          className=\"p-2 rounded-full bg-black/60 text-white hover:bg-black/80\"\n        >\n          <ArrowLeft className=\"w-6 h-6\" />\n        </button>\n        {title && (\n          <h1 className=\"text-white font-bold text-lg\">{title}</h1>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAae,SAAS,SAAS,EAAE,OAAO,EAAE,KAAK,EAAE,OAAO,EAAiB;IACzE,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,kDAAkD;QAClD,MAAM,SAAS,CAAA,GAAA,yHAAA,CAAA,aAAU,AAAD,EAAE;QAC1B,YAAY,OAAO,QAAQ;QAC3B,WAAW;QAEX,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,OAAO,QAAQ,EAAE;IAC5C,GAAG;QAAC;KAAQ;IAEZ,MAAM,cAAc,IAAM,UAAU,YAAY,OAAO,IAAI;IAE3D,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAAa;;;;;;;;;;;IAGlC;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBACC,KAAK;gBACL,WAAU;gBACV,eAAe;gBACf,OAAM;gBACN,OAAO;oBAAE,QAAQ;gBAAO;;;;;;0BAG1B,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBACC,SAAS;wBACT,WAAU;kCAEV,cAAA,8OAAC,gNAAA,CAAA,YAAS;4BAAC,WAAU;;;;;;;;;;;oBAEtB,uBACC,8OAAC;wBAAG,WAAU;kCAAgC;;;;;;;;;;;;;;;;;;AAKxD","debugId":null}},
    {"offset": {"line": 582, "column": 0}, "map": {"version":3,"sources":["file:///home/flex/Atto4/app/watch/%5Bmediatype%5D/%5Bid%5D/page.tsx"],"sourcesContent":["// app/watch/[mediatype]/[id]/page.tsx\n'use client';\n\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport MoviePlayer from '@/components/players/MoviePlayer';\nimport TvPlayer from '@/components/players/TvPlayer';\nimport { tmdbApi } from '@/lib/api/tmdb';\n\nexport default function WatchPage() {\n  const params = useParams();\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const [mediaData, setMediaData] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  const mediaType = params?.mediatype as 'movie' | 'tv';\n  const id = parseInt(params?.id as string, 10);\n\n  // Get season and episode from query params for TV shows (default to 1)\n  const season = parseInt(searchParams.get('season') || '1', 10);\n  const episode = parseInt(searchParams.get('episode') || '1', 10);\n\n  useEffect(() => {\n    // Hide body scroll for fullscreen experience\n    const prevOverflow = document.body.style.overflow;\n    document.body.style.overflow = 'hidden';\n\n    return () => {\n      document.body.style.overflow = prevOverflow || 'auto';\n    };\n  }, []);\n\n  useEffect(() => {\n    let cancelled = false;\n\n    async function loadMediaData() {\n      setLoading(true);\n      try {\n        let data = null;\n        if (mediaType === 'movie') {\n          data = await tmdbApi.getMovieDetails(id);\n        } else if (mediaType === 'tv') {\n          data = await tmdbApi.getTVShowDetails(id);\n        }\n\n        if (!cancelled) setMediaData(data);\n      } catch (error) {\n        console.error('Failed to load media:', error);\n        if (!cancelled) setMediaData(null);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    }\n\n    if (id && (mediaType === 'movie' || mediaType === 'tv')) {\n      loadMediaData();\n    } else {\n      setLoading(false);\n    }\n\n    return () => { cancelled = true; };\n  }, [id, mediaType]);\n\n  const handleClose = () => {\n    router.back();\n  };\n\n  if (loading) {\n    return (\n      <div className=\"fixed inset-0 bg-black flex items-center justify-center\">\n        <div className=\"text-white text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-2 border-white border-t-transparent mx-auto mb-4\"></div>\n          <p>Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!mediaData && (mediaType === 'movie' || mediaType === 'tv')) {\n    return (\n      <div className=\"fixed inset-0 bg-black flex items-center justify-center text-white\">\n        <div className=\"text-center\">\n          <h1 className=\"text-xl font-semibold mb-4\">Media not found</h1>\n          <button\n            onClick={handleClose}\n            className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors\"\n          >\n            Go Back\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Determine a display title (movie.title or tv.name)\n  const title = mediaData?.title ?? mediaData?.name ?? '';\n\n  // Render correct player\n  if (mediaType === 'movie') {\n    return (\n      <MoviePlayer\n        mediaId={id}\n        title={title}\n        onClose={handleClose}\n        // optional tuning:\n        guardMs={6000}\n        showControls={true}\n      />\n    );\n  }\n\n  if (mediaType === 'tv') {\n    return (\n      <TvPlayer\n        mediaId={id}\n        season={season}\n        episode={episode}\n        title={title}\n        onClose={handleClose}\n        // optional tuning values — tweak as desired:\n        guardMs={5000}\n        autoNextMs={25 * 60 * 1000} // auto-advance after ~25 minutes (optional)\n        showControls={true}\n      />\n    );\n  }\n\n  // Fallback for unknown mediatype\n  return (\n    <div className=\"fixed inset-0 bg-black flex items-center justify-center text-white\">\n      <div className=\"text-center\">\n        <h1 className=\"text-xl font-semibold mb-4\">Unsupported media type</h1>\n        <button\n          onClick={handleClose}\n          className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded transition-colors\"\n        >\n          Go Back\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"AAAA,sCAAsC;;;;;AAGtC;AACA;AACA;AACA;AACA;AANA;;;;;;;AAQe,SAAS;IACtB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IACvB,MAAM,eAAe,CAAA,GAAA,kIAAA,CAAA,kBAAe,AAAD;IACnC,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAO;IAChD,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAEvC,MAAM,YAAY,QAAQ;IAC1B,MAAM,KAAK,SAAS,QAAQ,IAAc;IAE1C,uEAAuE;IACvE,MAAM,SAAS,SAAS,aAAa,GAAG,CAAC,aAAa,KAAK;IAC3D,MAAM,UAAU,SAAS,aAAa,GAAG,CAAC,cAAc,KAAK;IAE7D,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,6CAA6C;QAC7C,MAAM,eAAe,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QACjD,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAE/B,OAAO;YACL,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,gBAAgB;QACjD;IACF,GAAG,EAAE;IAEL,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,IAAI,YAAY;QAEhB,eAAe;YACb,WAAW;YACX,IAAI;gBACF,IAAI,OAAO;gBACX,IAAI,cAAc,SAAS;oBACzB,OAAO,MAAM,kHAAA,CAAA,UAAO,CAAC,eAAe,CAAC;gBACvC,OAAO,IAAI,cAAc,MAAM;oBAC7B,OAAO,MAAM,kHAAA,CAAA,UAAO,CAAC,gBAAgB,CAAC;gBACxC;gBAEA,IAAI,CAAC,WAAW,aAAa;YAC/B,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yBAAyB;gBACvC,IAAI,CAAC,WAAW,aAAa;YAC/B,SAAU;gBACR,IAAI,CAAC,WAAW,WAAW;YAC7B;QACF;QAEA,IAAI,MAAM,CAAC,cAAc,WAAW,cAAc,IAAI,GAAG;YACvD;QACF,OAAO;YACL,WAAW;QACb;QAEA,OAAO;YAAQ,YAAY;QAAM;IACnC,GAAG;QAAC;QAAI;KAAU;IAElB,MAAM,cAAc;QAClB,OAAO,IAAI;IACb;IAEA,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;kCAAE;;;;;;;;;;;;;;;;;IAIX;IAEA,IAAI,CAAC,aAAa,CAAC,cAAc,WAAW,cAAc,IAAI,GAAG;QAC/D,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAG,WAAU;kCAA6B;;;;;;kCAC3C,8OAAC;wBACC,SAAS;wBACT,WAAU;kCACX;;;;;;;;;;;;;;;;;IAMT;IAEA,qDAAqD;IACrD,MAAM,QAAQ,WAAW,SAAS,WAAW,QAAQ;IAErD,wBAAwB;IACxB,IAAI,cAAc,SAAS;QACzB,qBACE,8OAAC,qIAAA,CAAA,UAAW;YACV,SAAS;YACT,OAAO;YACP,SAAS;YACT,mBAAmB;YACnB,SAAS;YACT,cAAc;;;;;;IAGpB;IAEA,IAAI,cAAc,MAAM;QACtB,qBACE,8OAAC,kIAAA,CAAA,UAAQ;YACP,SAAS;YACT,QAAQ;YACR,SAAS;YACT,OAAO;YACP,SAAS;YACT,6CAA6C;YAC7C,SAAS;YACT,YAAY,KAAK,KAAK;YACtB,cAAc;;;;;;IAGpB;IAEA,iCAAiC;IACjC,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAA6B;;;;;;8BAC3C,8OAAC;oBACC,SAAS;oBACT,WAAU;8BACX;;;;;;;;;;;;;;;;;AAMT","debugId":null}},
    {"offset": {"line": 792, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/lucide-react/dist/esm/icons/arrow-left.js","sources":["file:///home/flex/Atto4/node_modules/lucide-react/src/icons/arrow-left.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\nimport { IconNode } from '../types';\n\nexport const __iconNode: IconNode = [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n];\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('arrow-left', __iconNode);\n\nexport default ArrowLeft;\n"],"names":[],"mappings":";;;;;;;;;;;AAGO,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,UAAA,CAAA,CAAA,CAAuB;IAClC;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAkB,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;IAC/C;QAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAQ,CAAA;YAAE,GAAG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;YAAY,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;QAAA,CAAU;KAAA;CAC3C;AAaA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,SAAA,CAAA,CAAA,wKAAY,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAiB,CAAjB,AAAiB,CAAjB,AAAiB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAc,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,CAAA","debugId":null}}]
}